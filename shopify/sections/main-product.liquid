{%- comment -%}
  Product section

  The product section enables customers to view product details, images, and purchase options.
  It also includes a product schema for search engines to understand the product details.
{%- endcomment -%}

{%- liquid
  assign target = product.selected_or_first_available_variant
  if target.featured_media
    assign seo_media = target.featured_media
  else
    assign seo_media = product.featured_media
  endif
-%}

<section class='grid grid-cols-12 px-md gap-sm'>
  <!-- Product gallery -->
  <div class='col-span-8' data-cursor-zoom>
    {%- render 'product-gallery', product: product, section: section, class: '' -%}

    <!-- Product lightbox -->
    {% comment %} {% render 'product-lightbox', product: product, section: section %} {% endcomment %}
  </div>

  <!-- Product info -->
  <div class='col-start-9 col-span-4'>
    {%- render 'product-info',
      product: product,
      section: section,
      class: 'sticky top-20 block'
    -%}
  </div>

  <!-- Product schema -->
  <script type='application/ld+json'>
    {
      "@context": "http://schema.org/",
      "@type": "Product",
      "name": {{ product.title | json }},
      "url": {{ request.origin | append: product.url | json }},
      {% if seo_media -%}
        "image": [
          {{ seo_media | image_url: width: 1920 | prepend: "https:" | json }}
        ],
      {%- endif %}
      "description": {{ product.description | strip_html | json }},
      {% if target.sku != blank -%}
        "sku": {{ target.sku | json }},
      {%- endif %}
      "brand": {
        "@type": "Brand",
        "name": {{ product.vendor | json }}
      },
      "offers": [
        {%- for variant in product.variants -%}
          {
            "@type" : "Offer",
            {%- if variant.sku != blank -%}
              "sku": {{ variant.sku | json }},
            {%- endif -%}
            {%- if variant.barcode.size == 12 -%}
              "gtin12": {{ variant.barcode }},
            {%- endif -%}
            {%- if variant.barcode.size == 13 -%}
              "gtin13": {{ variant.barcode }},
            {%- endif -%}
            {%- if variant.barcode.size == 14 -%}
              "gtin14": {{ variant.barcode }},
            {%- endif -%}
            "availability" : "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
            "price" : {{ variant.price | divided_by: 100.00 | json }},
            "priceCurrency" : {{ cart.currency.iso_code | json }},
            "url" : {{ request.origin | append: variant.url | json }}
          }{% unless forloop.last %},{% endunless %}
        {%- endfor -%}
      ]
    }
  </script>
</section>

{% schema %}
{
  "name": "t:sections.main-product.name",
  "blocks": [
    {
      "type": "@app"
    },
    {
      "name": "t:sections.main-product.blocks.text.name",
      "type": "text",
      "limit": 1,
      "settings": [
        {
          "type": "inline_richtext",
          "id": "text",
          "label": "t:sections.main-product.blocks.text.settings.text.label",
          "info": "t:sections.main-product.blocks.text.settings.text.info"
        }
      ]
    },
    {
      "name": "t:sections.main-product.blocks.title.name",
      "type": "title",
      "limit": 1
    },
    {
      "name": "t:sections.main-product.blocks.description.name",
      "type": "description",
      "limit": 1
    },
    {
      "name": "t:sections.main-product.blocks.inventory.name",
      "type": "inventory",
      "limit": 1,
      "settings": [
        {
          "type": "range",
          "id": "inventory_threshold",
          "label": "t:sections.main-product.blocks.inventory.settings.inventory_threshold.label",
          "min": 0,
          "max": 100,
          "step": 1,
          "info": "t:sections.main-product.blocks.inventory.settings.inventory_threshold.info",
          "default": 10
        },
        {
          "type": "checkbox",
          "id": "show_inventory_quantity",
          "label": "t:sections.main-product.blocks.inventory.settings.show_inventory_quantity.label",
          "info": "t:sections.main-product.blocks.inventory.settings.show_inventory_quantity.info",
          "default": true
        }
      ]
    },
    {
      "name": "t:sections.main-product.blocks.price.name",
      "type": "price",
      "limit": 1
    },
    {
      "name": "t:sections.main-product.blocks.sku.name",
      "type": "sku",
      "limit": 1
    },
    {
      "name": "t:sections.main-product.blocks.custom_liquid.name",
      "type": "custom_liquid",
      "limit": 1
    },
    {
      "name": "t:sections.main-product.blocks.collapsible_tab.name",
      "type": "collapsible_tab",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.main-product.blocks.collapsible_tab.settings.heading.label",
          "info": "t:sections.main-product.blocks.collapsible_tab.settings.heading.info"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "t:sections.main-product.blocks.collapsible_tab.settings.content.label",
          "info": "t:sections.main-product.blocks.collapsible_tab.settings.content.info"
        },
        {
          "type": "page",
          "id": "page",
          "label": "t:sections.main-product.blocks.collapsible_tab.settings.page.label",
          "info": "t:sections.main-product.blocks.collapsible_tab.settings.page.info"
        }
      ]
    },
    {
      "name": "t:sections.main-product.blocks.quantity_selector.name",
      "type": "quantity_selector",
      "limit": 1
    },
    {
      "name": "t:sections.main-product.blocks.variant_picker.name",
      "type": "variant_picker",
      "limit": 1
    },
    {
      "type": "buy_buttons",
      "name": "t:sections.main-product.blocks.buy_buttons.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "default": true,
          "label": "t:sections.main-product.blocks.buy_buttons.settings.show_dynamic_checkout.label",
          "info": "t:sections.main-product.blocks.buy_buttons.settings.show_dynamic_checkout.info"
        },
        {
          "type": "checkbox",
          "id": "show_gift_card_recipient",
          "default": false,
          "label": "t:sections.main-product.blocks.buy_buttons.settings.show_gift_card_recipient.label",
          "info": "t:sections.main-product.blocks.buy_buttons.settings.show_gift_card_recipient.info"
        }
      ]
    },
    {
      "type": "pickup_availability",
      "name": "t:sections.main-product.blocks.pickup_availability.name",
      "limit": 1
    },
    {
      "type": "complementary",
      "name": "t:sections.main-product.blocks.complementary.name",
      "limit": 1,
      "settings": [
        {
          "type": "range",
          "id": "product_limit",
          "label": "t:sections.main-product.blocks.complementary.settings.product_limit.label",
          "info": "t:sections.main-product.blocks.complementary.settings.product_limit.info",
          "min": 1,
          "max": 10,
          "step": 1,
          "default": 3
        }
      ]
    }
  ]
}
{% endschema %}
