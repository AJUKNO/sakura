{% layout none %}

<!doctype html>
<html lang='{{ request.locale.iso_code }}'>
  <head>
    <script src='{{ 'vendor/qrcode.js' | shopify_asset_url }}' defer></script>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <meta name='theme-color' content='{{ settings.color_background }}'>
    <link rel='canonical' href='{{ canonical_url }}'>

    {%- if settings.favicon != blank -%}
      <link
        rel='icon'
        type='image/png'
        href='{{ settings.favicon | image_url: width: 32, height: 32 }}'
      >
    {%- endif -%}

    {%- unless settings.type_header_font.system?
      and settings.type_body_font.system?
    -%}
      <link rel='preconnect' href='https://fonts.shopifycdn.com' crossorigin>
    {%- endunless -%}

    {%- assign formatted_balance = gift_card.balance
      | money_without_trailing_zeros
      | strip_html
    -%}

    <title>
      {{ 'gift_cards.issued.title' | t: value: formatted_balance, shop: shop.name }}
    </title>

    <meta name='description' content='{{ 'gift_cards.issued.subtext' | t }}'>

    {{ content_for_header }}

    {%- liquid
      assign body_font_bold = settings.type_body_font | font_modify: 'weight', 'bold'
      assign body_font_italic = settings.type_body_font | font_modify: 'style', 'italic'
      assign body_font_bold_italic = body_font_bold | font_modify: 'style', 'italic'
    -%}

    {%- style -%}
      {{- settings.type_body_font | font_face: font_display: 'swap' -}}
      {{- body_font_bold | font_face: font_display: 'swap' -}}
      {{- body_font_italic | font_face: font_display: 'swap' -}}
      {{- body_font_bold_italic | font_face: font_display: 'swap' -}}
      {{- settings.type_header_font | font_face: font_display: 'swap' -}}

      :root {
        --font-body-family: {{ settings.type_body_font.family }}, {{ settings.type_body_font.fallback_families }};
        --font-body-style: {{ settings.type_body_font.style }};
        --font-body-weight: {{ settings.type_body_font.weight }};

        --font-heading-family: {{ settings.type_header_font.family }}, {{ settings.type_header_font.fallback_families }};
        --font-heading-style: {{ settings.type_header_font.style }};
        --font-heading-weight: {{ settings.type_header_font.weight }};
      }
    {%- endstyle -%}

    {%- unless settings.type_body_font.system? -%}
      {% comment %}theme-check-disable AssetPreload{% endcomment %}
      <link
        rel='preload'
        as='font'
        href='{{ settings.type_body_font | font_url }}'
        type='font/woff2'
        crossorigin
      >
      {% comment %}theme-check-enable AssetPreload{% endcomment %}
    {%- endunless -%}
    {%- unless settings.type_header_font.system? -%}
      {% comment %}theme-check-disable AssetPreload{% endcomment %}
      <link
        rel='preload'
        as='font'
        href='{{ settings.type_header_font | font_url }}'
        type='font/woff2'
        crossorigin
      >
      {% comment %}theme-check-enable AssetPreload{% endcomment %}
    {%- endunless -%}

    {{- 'global.css' | asset_url | stylesheet_tag -}}
  </head>

  <body class='bg-accent text-on-accent p-lg flex gap-md flex-col items-center min-h-dvh justify-center text-center'>
    <header class='space-y-sm'>
      <h1 class='text-2xl'>
        {% if settings.currency_code_enabled %}
          {{ gift_card.balance | money_with_currency }}
        {% else %}
          {{ gift_card.balance | money }}
        {% endif %}
      </h1>
      {%- if true -%}
        <p class='bg-primary p-sm text-sm text-on-primary drop-shadow-sm rounded-md'>
          {{ 'gift_cards.issued.expired' | t }}
        </p>
      {%- endif -%}

      {% if gift_card.expires_on %}
        {%- assign gift_card_expiration_date = gift_card.expires_on
          | date: '%B %e, %Y'
        -%}
        <p>
          {{
            'gift_cards.issued.expiration_date'
            | t: expires_on: gift_card_expiration_date
          }}
        </p>
      {% endif %}
    </header>

    <main class='flex flex-col items-center gap-md'>
      <div>
        {%- if settings.logo != blank -%}
          {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
          {{
            settings.logo
            | image_url: width: 570
            | image_tag: class: 'h-16', alt: logo_alt
          }}
        {%- else %}
          <img
            class='gift-card__image'
            src='{{ 'gift-card/card.svg' | shopify_asset_url }}'
            alt=''
            height='{{ 300 | divided_by: 1.5 }}'
            width='300'
          >
        {%- endif %}
      </div>
      <h2>{{ shop.name }}</h2>
      <p>
        {{ 'gift_cards.issued.how_to_use_gift_card' | t }}
      </p>
      <p id='gift-card-code'>
        {{ gift_card.code | format_code }}
      </p>
      <div
        id='gift-card-qr-code'
        data-identifier='{{ gift_card.qr_identifier }}'
      ></div>
      {%- if gift_card.pass_url -%}
        <a
          href='{{ gift_card.pass_url }}'
        >
          <img
            src='{{ 'gift-card/add-to-apple-wallet.svg' | shopify_asset_url }}'
            width='120'
            height='40'
            alt='{{ 'gift_cards.issued.add_to_apple_wallet' | t }}'
            loading='lazy'
          >
        </a>
      {%- endif -%}
      <div class='gap-md flex flex-col items-center'>
        <span
          id='gift-card-copy-success'
          role='status'
        ></span>
        <template>
          {{ 'gift_cards.issued.copy_code_success' | t }}
        </template>
        <button id='gift-card-copy-button'>
          {{ 'gift_cards.issued.copy_code' | t }}
        </button>
        <a
          href='{{ shop.url }}'
          class='button button--secondary'
          target='_blank'
          rel='noopener'
          aria-describedby='a11y-new-window-message'
        >
          {{ 'gift_cards.issued.shop_link' | t }}
        </a>
      </div>
    </main>

    <div hidden>
      <span id='a11y-new-window-message'>
        {{- 'accessibility.link_messages.new_window' | t -}}
      </span>
    </div>
  </body>
</html>

<script>
  const string = { qrImageAlt: {{ 'gift_cards.issued.qr_image_alt' | t | json }} };

  const qrCode = document.getElementById('gift-card-qr-code');

  document.addEventListener('DOMContentLoaded', function() {
    // Generate QR code
    new QRCode(qrCode, {
      text: qrCode.dataset.identifier,
      width: 72,
      height: 72,
      imageAltText: string.qrImageAlt
    });
  });

  const template = document.getElementsByTagName("template")[0];
  const clonedTemplate = template.content.cloneNode(true);
  let isMessageDisplayed = false

  const copySuccess = document.getElementById('.gift-card_copy-success');
  const copyButton = document.getElementById('gift-card-copy-button');
  copyButton.addEventListener('click', () => {
    navigator.clipboard.writeText(qrCode.innerText).then(() => {
      if (!isMessageDisplayed) {
        copySuccess.appendChild(clonedTemplate);
        isMessageDisplayed = true
      }
    })
  })
</script>
