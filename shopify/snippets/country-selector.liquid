{%- comment -%}
  Renders a country selector

  Accepts:
    - class: {String} Additional classes

  Usage:
  {%- render 'country-selector',
    class: 'mb-md'
  -%}
{%- endcomment -%}

{% liquid
  assign accessibility_close = 'accessibility.close' | t
  assign component_id = 'country-selector'
%}

{% if localization.available_countries.size > 1 %}
  <button
    data-id='{{  component_id | append: '-open-button' }}'
    aria-expanded='false'
    type='button'
    class='flex gap-sm items-center {{ class }}'
    aria-controls='{{ component_id | append: '-menu' }}'
  >
    <svg
      xmlns='http://www.w3.org/2000/svg'
      class='h-5 w-auto'
      fill='currentColor'
      viewBox='0 0 256 256'
    >
      <path d="M128,24h0A104,104,0,1,0,232,128,104.12,104.12,0,0,0,128,24Zm88,104a87.61,87.61,0,0,1-3.33,24H174.16a157.44,157.44,0,0,0,0-48h38.51A87.61,87.61,0,0,1,216,128ZM102,168H154a115.11,115.11,0,0,1-26,45A115.27,115.27,0,0,1,102,168Zm-3.9-16a140.84,140.84,0,0,1,0-48h59.88a140.84,140.84,0,0,1,0,48ZM40,128a87.61,87.61,0,0,1,3.33-24H81.84a157.44,157.44,0,0,0,0,48H43.33A87.61,87.61,0,0,1,40,128ZM154,88H102a115.11,115.11,0,0,1,26-45A115.27,115.27,0,0,1,154,88Zm52.33,0H170.71a135.28,135.28,0,0,0-22.3-45.6A88.29,88.29,0,0,1,206.37,88ZM107.59,42.4A135.28,135.28,0,0,0,85.29,88H49.63A88.29,88.29,0,0,1,107.59,42.4ZM49.63,168H85.29a135.28,135.28,0,0,0,22.3,45.6A88.29,88.29,0,0,1,49.63,168Zm98.78,45.6a135.28,135.28,0,0,0,22.3-45.6h35.66A88.29,88.29,0,0,1,148.41,213.6Z"></path>
    </svg>
    <span>
      {{- localization.country.name }} ({{ localization.country.currency.iso_code }}
      {{ localization.country.currency.symbol }})</span
    >
  </button>

  <cmp-localization-form
    data-id='{{  component_id }}'
    data-section-id='{{ section.id }}'
    class='group/parent fixed z-40'
  >
    <div
      data-id='{{  component_id | append: '-overlay' }}'
      class='bg-background/20 backdrop-blur-sm transition-all duration-[600ms] ease-in-out group-data-[open]/parent:visible invisible group-data-[open]/parent:opacity-100 opacity-0 group-data-[open]/parent:pointer-events-auto pointer-events-none fixed inset-0 z-30'
    ></div>
    <div
      id='{{ component_id |  append: '-menu' }}'
      tabindex='0'
      class='bottom-0 w-[36rem] border-l-[1px] border-border/20 fixed z-40 right-0 top-0 group-data-[open]/parent:translate-x-0 transition-all duration-[600ms] ease-in-out translate-x-full group/menu bg-background text-foreground overflow-y-auto'
      data-id='{{  component_id | append: '-menu' }}'
    >
      {% comment %} Header {% endcomment %}
      <div
        class='h-20 bg-background border-b-[1px] border-border/20 sticky z-10 top-0 p-md py-md flex justify-between items-center'
      >
        <h3
          data-id='country-selector-title'
          class=' font-black flex items-center gap-sm uppercase'
        >
          <span>Country</span>
        </h3>
        <button
          aria-label='{{ accessibility_close }}'
          data-id='{{  component_id | append: '-close-button' }}'
          class='hover:rotate-90 hover:opacity-50 transition-all duration-[400ms] ease-in-out'
        >
          <svg
            class='w-auto h-6'
            viewBox='0 0 152 168'
            fill='none'
            xmlns='http://www.w3.org/2000/svg'
          >
            <path fill-rule="evenodd" clip-rule="evenodd" d="M97.1014 47.0755C140.786 -3.51857 183.417 71.3187 118.154 83.4401C183.417 96.0887 140.26 170.399 97.1014 119.804C119.207 183.047 33.4167 182.52 55.5222 119.804C11.8376 170.399 -30.7942 96.0887 34.4693 83.4401C-31.3205 71.3187 11.8376 -2.99156 55.5222 47.0755C32.8904 -15.6401 119.207 -15.6401 97.1014 47.0755ZM76.0483 73.9537C81.3119 73.9537 86.0485 78.17 86.0485 83.4401C86.0485 88.7102 81.3119 93.4537 76.0483 93.4537C70.7853 93.4537 66.5744 88.7102 66.5744 83.4401C66.5744 78.17 70.7853 73.9537 76.0483 73.9537Z" fill="currentColor"/>
          </svg>
        </button>
      </div>

      {% comment %} Form {% endcomment %}
      {% form 'localization' %}
        <ul
          role='list'
        >
          {% for country in localization.available_countries %}
            <li
              tabindex='-1'
            >
              <a
                href='#'
                {% if country.iso_code == localization.country.iso_code %}
                  aria-current='true'
                {% endif %}
                class='p-md border-b-[1px] border-border/5 block hover:opacity-50 transition-all duration-300 ease-in-out'
                data-value='{{ country.iso_code }}'
              >
                {{ country.name }} ({{ country.currency.iso_code }}
                {{ country.currency.symbol }})
              </a>
            </li>
          {% endfor %}
        </ul>

        <input
          type='hidden'
          name='country_code'
          value='{{ localization.country.iso_code }}'
        >
      {% endform %}
    </div>
  </cmp-localization-form>
{% endif %}
