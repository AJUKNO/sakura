{%- comment -%}
  Renders a media component

  Accepts:
    - media: {Object} - the media to render
    - type: {String} - the type of media to render
    - class: {String} - the class to apply to the media component

  Usage:
    {%- render 'cmp-media',
        media: image,
        type: 'image'
        class: 'media--fill'
    -%}
{%- endcomment -%}

{%- liquid
  if media.media_type != blank
    assign media_type = media.media_type
  else
    assign media_type = type
  endif
%}

<cmp-media
  data-id='{{ media.id }}'
  class='{{ class }}'
>
  {%- case media_type -%}
    {% when 'image' %}
      {{ media | image_url: width: 2048 | image_tag: loading: loading }}
    {% when 'external_video' %}
      {{ media | external_video_tag }}
    {% when 'video' %}
      {{
        media
        | video_tag: controls: true, muted: true, loop: true, autoplay: true
      }}
    {% when 'model' %}
      {{ media | model_viewer_tag }}
    {% else %}
      {{ media | media_tag }}
  {%- endcase -%}
  {% comment %}
    {%- if lazy_load -%}
      {%- case media_type -%}
        {%- when 'image' -%}
          <img
            src=''
            srcset=''
            sizes='
              (max-width: 320px) 280px,
              (max-width: 640px) 580px,
              1000px
            '
            data-srcset='
              {%- if media.width >= 165 -%}{{ media | image_url: width: 165 }} 165w,{%- endif -%}
              {%- if media.width >= 360 -%}{{ media | image_url: width: 360 }} 360w,{%- endif -%}
              {%- if media.width >= 535 -%}{{ media | image_url: width: 535 }} 535w,{%- endif -%}
              {%- if media.width >= 750 -%}{{ media | image_url: width: 750 }} 750w,{%- endif -%}
              {%- if media.width >= 1070 -%}{{ media | image_url: width: 1070 }} 1070w,{%- endif -%}
              {%- if media.width >= 1500 -%}{{ media | image_url: width: 1500 }} 1500w,{%- endif -%}
              {{ media | image_url }} {{ media.width }}w
            '
            data-src='{{ media | image_url: width: 750 }}'
            loading='lazy'
            alt='{{ media.alt | escape }}'
            width='{{ media.width }}'
            height='{{ media.height }}'
          >
        {%- when 'video' -%}
          <video
            muted='true'
            loop='true'
            autoplay='true'
            data-poster='{{ media.preview_image | image_url: width: 500 }}'
          >
            {%- for source in media.sources -%}
              <source data-src='{{ source.url }}' type='{{ source.mime_type }}'>
            {%- endfor -%}
          </video>
        {%- else -%}
      {%- endcase -%}
    {%- else -%}
      {%- case media_type -%}
        {%- when 'image' -%}
          {{ media | image_url: width: 2048, height: 2048 | image_tag }}
        {%- when 'video' -%}
          {{
            media
            | video_tag: controls: false, muted: true, loop: true, autoplay: true
          }}
        {%- else -%}
      {%- endcase -%}
    {%- endif -%}
  {% endcomment %}
</cmp-media>
